  ---
import { metrics } from '@/config'
---

<div id='widget'>
  加载中...
</div>

<script is:inline type='module' data-astro-rerun define:vars={{ metrics: metrics }}>
  if (metrics.enable && metrics.widget) {
    fetch(metrics.widget)
      .then((res) => res.text())
      .then((data) => {
        let num = data.match(/(<\/span><span>).*?(\/span><\/p>)/g)
        if (!num) {
          console.warn('51.la 数据匹配失败')
          return
        }
        num = num.map((el) => el.replace(/(<\/span><span>|<\/span><\/p>)/g, ''))
        const titles = [
          '最近活跃',
          '今日人数',
          '今日访问',
          '昨日人数',
          '昨日访问',
          '本月访问',
          '总访问量'
        ]
        const container = document.getElementById('widget')
        if (!container) return

        // 容器样式：与站点风格一致的卡片网格
        container.className = 'not-prose grid grid-cols-2 gap-3 sm:grid-cols-4'

        // 生成卡片
        const cards = titles.map((title, i) => {
          const value = num[i] ?? '—'
          return `
            <div class="rounded-lg border border-app-border/60 bg-background/60 p-3">
              <div class="text-2xs text-app-dim">${title}</div>
              <div class="mt-1 text-lg font-bold">${value}</div>
            </div>
          `
        }).join('')

        container.innerHTML = cards
      })
      .catch((err) => {
        console.error('51.la 数据获取失败:', err)
        document.getElementById('widget').innerHTML = '加载失败'
      })
  }
</script>